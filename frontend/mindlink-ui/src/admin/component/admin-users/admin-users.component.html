<section class="admin-users">
  <!-- Header con statistiche -->
  <div class="header">
    <div class="title-section">
      <h2>
        <span class="icon">ğŸ‘¥</span>
        Gestione Utenti
      </h2>
      <p class="subtitle">Amministra gli utenti della piattaforma</p>
    </div>
  </div>

  <!-- Statistiche -->
  <div class="stats-grid" *ngIf="!loading">
    <div class="stat-card">
      <div class="stat-icon">ğŸ‘¤</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.total }}</div>
        <div class="stat-label">Totale Utenti</div>
      </div>
    </div>
    <div class="stat-card active">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.active }}</div>
        <div class="stat-label">Attivi</div>
      </div>
    </div>
    <div class="stat-card banned">
      <div class="stat-icon">ğŸš«</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.banned }}</div>
        <div class="stat-label">Bannati</div>
      </div>
    </div>
    <div class="stat-card ideas">
      <div class="stat-icon">ğŸ’¡</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.totalIdeas }}</div>
        <div class="stat-label">Idee Totali</div>
      </div>
    </div>
  </div>

  <!-- Filtri e ricerca -->
  <div class="controls" *ngIf="!loading">
    <div class="search-box">
      <span class="search-icon">ğŸ”</span>
      <input
        type="text"
        placeholder="Cerca per username o email..."
        (input)="onSearch($event)"
        [value]="searchTerm"
      />
    </div>

    <div class="filter-tabs">
      <button
        class="filter-tab"
        [class.active]="filterStatus === 'all'"
        (click)="setFilter('all')"
      >
        Tutti
      </button>
      <button
        class="filter-tab"
        [class.active]="filterStatus === 'active'"
        (click)="setFilter('active')"
      >
        Attivi
      </button>
      <button
        class="filter-tab"
        [class.active]="filterStatus === 'banned'"
        (click)="setFilter('banned')"
      >
        Bannati
      </button>
    </div>
  </div>

  <!-- Griglia utenti -->
  <div class="users-grid" *ngIf="!loading; else loadingTpl">
    <div class="user-card" *ngFor="let u of filteredUsers" [class.banned]="!u.is_active">
      <div class="user-card-header">
        <div class="user-avatar" [class.inactive]="!u.is_active">
          {{ getUserInitials(u.username) }}
        </div>
        <div class="user-info">
          <h3 class="user-name">{{ u.username }}</h3>
          <p class="user-email">{{ u.email }}</p>
        </div>
        <div class="user-status">
          <span class="status-badge" [class.active]="u.is_active" [class.banned]="!u.is_active">
            {{ u.is_active ? 'âœ… Attivo' : 'ğŸš« Bannato' }}
          </span>
        </div>
      </div>

      <div class="user-card-body">
        <div class="user-meta">
          <div class="meta-item">
            <span class="meta-icon">ğŸ’¡</span>
            <span class="meta-value">{{ u.idea_count }}</span>
            <span class="meta-label">idee</span>
          </div>
          <div class="meta-item">
            <span class="meta-icon">ğŸ“…</span>
            <span class="meta-value">{{ getRelativeDate(u.date_joined) }}</span>
          </div>
        </div>

        <div class="user-actions">
          <button
            class="btn-action"
            [class.btn-ban]="u.is_active"
            [class.btn-unban]="!u.is_active"
            (click)="toggleUser(u)"
          >
            <span class="btn-icon">{{ u.is_active ? 'ğŸš«' : 'âœ…' }}</span>
            <span class="btn-text">{{ u.is_active ? 'Banna utente' : 'Riattiva utente' }}</span>
          </button>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="filteredUsers.length === 0">
      <div class="empty-icon">ğŸ”</div>
      <h3>Nessun utente trovato</h3>
      <p>Prova a modificare i filtri di ricerca</p>
    </div>
  </div>

  <!-- Loading state -->
  <ng-template #loadingTpl>
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Caricamento utenti...</p>
    </div>
  </ng-template>
</section>
